<html>
    <head>
        <title> Next | Task Detail </title>
        <link rel="stylesheet" href="css/css.css">
        <link rel="stylesheet" href="css/buattask.css">
        <script>
            function submit_comment(form) {
				if (window.XMLHttpRequest){
					xmlhttp = new XMLHttpRequest();				
				} else {
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");	
				}
				
				xmlhttp.onreadystatechange = function(){
                    if (xmlhttp.readyState==4 && xmlhttp.status==200)	{
						if (xmlhttp.responseText==1) {
							//Masukin hasilnya ke dalam div komen
                            var daftar_komentar = document.getElementById("komen");
                            
                            var tambah = '<div id = "daftarkomen">'
                            tambah += "User :<br>";
                            tambah += form.comment.value;
                            tambah += "</div>";
                            var n = daftar_komentar.innerHTML.indexOf("<form name");
                            //alert(daftar_komentar.innerHTML.substring(0,n));
                            //alert(daftar_komentar.innerHTML.substring(n));
                            daftar_komentar.innerHTML = daftar_komentar.innerHTML.substring(0,n)
                                                      + tambah
                                                      + daftar_komentar.innerHTML.substring(n);
                            //alert(daftar_komentar.innerHTML);
						} else {
							alert("Gagal memposting komentar");
						}						
					}
				}
				
                params = "komentar="+escape(form.comment.value)+"&user="+localStorage.userLogin+"&id_tugas="+"1";
                //alert(params);
				xmlhttp.open("POST","tambah_komentar.php",true);
                xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				xmlhttp.send(params);
            }
        
            function take_data() {
                if (window.XMLHttpRequest) {
                    xmlhttp1 = new XMLHttpRequest();
                    xmlhttp2 = new XMLHttpRequest();
                } else {
                    xmlhttp1 = new ActiveXObject("Microsoft.XMLHTTP");
                    xmlhttp2 = new ActiveXObject("Microsoft.XMLHTTP");
                }
                
                xmlhttp1.onreadystatechange = function() {
                    if (xmlhttp1.readyState == 4 && xmlhttp1.status == 200) {
                    
                    }
                }
                
                xmlhttp2.onreadystatechange = function() {
                    if (xmlhttp2.readyState == 4 && xmlhttp2.status == 200) {
                        alert("OK");
                        var s = xmlhttp2.responseText;
                        var n = s.indexOf("\n");
                        alert(n);
                        
                        while (n != -1) {
                            //Ambil satu data komentar
                            var username = s.substring(0,n);
                            s = s.substring(n+1);
                            n = s.indexOf("\n");
                            
                            var tanggal = s.substring(0,n);
                            s = s.substring(n+1);
                            n = s.indexOf("\n");

                            var komentar = unescape(s.substring(0,n));
                            s = s.substring(n+1);
                            n = s.indexOf("\n");
                            
                            //Tampilkan datanya
                            var daftar_komentar = document.getElementById("komen");
                            
                            var tambah = '<div id = "daftarkomen">'
                            tambah += username + " " + tanggal + "<br>";
                            tambah += komentar;
                            tambah += "</div>";
                            var i = daftar_komentar.innerHTML.indexOf("<form name");
                            daftar_komentar.innerHTML = daftar_komentar.innerHTML.substring(0,i)
                                                      + tambah
                                                      + daftar_komentar.innerHTML.substring(i);                            
                        }
                    }
                }
                
                //Untuk mengambil daftar komentar awal
                params = "id_tugas="+"1";
                xmlhttp2.open("POST","ambil_komentar.php",true);
                xmlhttp2.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                xmlhttp2.send(params);
            }
        
            function showEdit(){
                document.getElementById("detailedit").style.visibility="visible";
                document.getElementById("detail").style.visibility="hidden";
            }
            function hideEdit(){
                document.getElementById("detailedit").style.visibility="hidden";
                document.getElementById("detail").style.visibility="visible";
            }
        </script>
    </head>
    <body onload="take_data()">
        <div class="header">
            <div id="logo">
                <a hreg="dashboard.html">
                <img src="pict/logo.png">
                </a>
            </div>
            <div id="border">
                
            </div>
            <div id="dashboard">
                <a href="dashboard.html">DASHBOARD</a>
            </div>
            <div id="profile">
                <a href="profile.html">PROFILE</a>
            </div>
            <div id="search">
				<section class="searchform cf">
					<input class="searchbox" type="search" name="search" placeholder="Search.." required>
					
				</section>
				<section class="searchbuttonbox cf">
					<img class="searchbutton"src="pict/search button.jpg">
				</section>
				
			</div>
            <div id="wellfaiz">
                
            </div>
            <div id="logout">
                <a href="index.html">LOGOUT</a>
            </div>
        </div>
        <div class="main">
            <div id="edit" onclick="showEdit()">
            </div>
            <a href="dashboard.html">
                <div id="back">
                </div>
            </a>
            <div id="rinciantugas">
                <div id="judultugas">TUBES 1</div>
                <div id="detail" style="visibility: visible">
                    
                        <label>DEADLINE</label>
                        <a id="deadline">11/08/2013</a>
                        
                         <label>ASSIGNEE</label>
                        <a id="assignee">Faiz</a>
                        
                         <label>TAG</label>
                        <a id="tag">KAP</a>
                        
                         <label>ATTACHMENT</label>
                        <a href ="#" id="attach">Download Here</a>
                    
                </div>
                <div id="detailedit" style="visibility: hidden">
                    <form >
                        <label>DEADLINE</label>
                        <a id="deadline">11/08/2013</a>
                        
                         <label>ASSIGNEE</label>
                        <a id="assignee">Faiz</a></br>
                        <input name="assignee" placeholder="assignee">
                        
                         <label>TAG</label>
                        <input name="catname" placeholder="tag">
                        
                         <label>ATTACHMENT</label>
                        <a href ="#" id="attach">Download Here</a>
                        </br>
                        <input class= "submitreg" name="submit" type="submit" value="Submit" onclick="hideEdit()">
                    </form>
                </div>
            </div>
            <div id="komen">
                <form name="form_comment">
                    <div id="submitkomen">
                        <label>submit comment</label>
                        <textarea name="comment" type="comment" placeholder="comment" class="isikomen"></textarea>
                        <input class= "submitreg" name="submit" type="button" onclick="submit_comment(this.form)" value="Submit">
                    </div>
                </form>
            </div>
        </div>
        <div class="footer">
            Copyright © Ahmad Faiz - Fandi Pradana - Sigit Aji
        </div>
        
    </body>
</html>